<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Blackjack - Ronda {{ round }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='game.css') }}">
</head>
<body>
    <h1>Blackjack</h1>
    <h2>Jugador: {{ player_name }}</h2>
    <h2 style="margin-top: 0; margin-bottom: 32px; font-weight: normal; font-size: 1.5em; color: #b0e0ff;">Ronda {{ round }} de 3</h2>
    {% if last_winner %}
    <div id="winner-modal" class="modal-overlay">
        <div class="modal-content">
            {% if last_winner in ['Empate', 'empate', 'Draw', 'draw'] %}
                <h2>Empate</h2>
                <div class="modal-cards">
                    <div>
                        <h3>Cartas Jugador</h3>
                        <div class="cards-row">
                            {% for card in history[-1].player_hand %}
                                <span class="card">
                                    {% set palo = card[1].replace('ó','o').replace('é','e') %}
                                    <img class="card-img" src="{{ url_for('static', filename='cartas/' + card[0] + '_' + palo + '.png') }}" alt="{{ card[0] }} de {{ card[1] }}">
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <h3>Cartas PC</h3>
                        <div class="cards-row">
                            {% for card in history[-1].pc_hand %}
                                <span class="card">
                                    {% set palo = card[1].replace('ó','o').replace('é','e') %}
                                    <img class="card-img" src="{{ url_for('static', filename='cartas/' + card[0] + '_' + palo + '.png') }}" alt="{{ card[0] }} de {{ card[1] }}">
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% else %}
                <h2>Ganador de la ronda: {{ last_winner }}</h2>
                <div class="modal-cards">
                    {% if last_winner in ['Usuario', 'Jugador'] %}
                    <div>
                        <h3>Cartas Jugador</h3>
                        <div class="cards-row">
                            {% for card in history[-1].player_hand %}
                                <span class="card">
                                    {% set palo = card[1].replace('ó','o').replace('é','e') %}
                                    <img class="card-img" src="{{ url_for('static', filename='cartas/' + card[0] + '_' + palo + '.png') }}" alt="{{ card[0] }} de {{ card[1] }}">
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% elif last_winner in ['PC', 'Pc', 'pc'] %}
                    <div>
                        <h3>Cartas PC</h3>
                        <div class="cards-row">
                            {% for card in history[-1].pc_hand %}
                                <span class="card">
                                    {% set palo = card[1].replace('ó','o').replace('é','e') %}
                                    <img class="card-img" src="{{ url_for('static', filename='cartas/' + card[0] + '_' + palo + '.png') }}" alt="{{ card[0] }} de {{ card[1] }}">
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            {% endif %}
            <form action="/game" method="get">
                <button type="submit" class="btn-continuar">Continuar</button>
            </form>
        </div>
    </div>
    {% endif %}
    {% if pc_animating %}
    <script>
        setTimeout(function() { window.location.href = '/pc_turn'; }, 900);
    </script>
    {% endif %}
    <h2>Tu mano:</h2>
    <div class="cards-row">
        {% for card in player_hand %}
            <span class="card">
                {% set palo = card[1].replace('ó','o').replace('é','e') %}
                <img class="card-img" src="{{ url_for('static', filename='cartas/' + card[0] + '_' + palo + '.png') }}" alt="{{ card[0] }} de {{ card[1] }}">
            </span>
        {% endfor %}
    </div>
    <h2>Mano del PC:</h2>
    <div class="cards-row">
        {% for card in pc_hand %}
            <span class="card">
                {% if card[0] == '?' %}
                    <img class="card-img" src="{{ url_for('static', filename='cartas/back.png') }}" alt="Carta oculta">
                {% else %}
                    {% set palo = card[1].replace('ó','o').replace('é','e') %}
                    <img class="card-img" src="{{ url_for('static', filename='cartas/' + card[0] + '_' + palo + '.png') }}" alt="{{ card[0] }} de {{ card[1] }}">
                {% endif %}
            </span>
        {% endfor %}
    </div>
    <p>Puntaje Jugador: {{ player_score }} | Puntaje PC: {{ pc_score }}</p>
    <form action="/hit" method="get" style="display:inline;">
        <button type="submit" class="btn-pedir" {% if pc_animating %}disabled{% endif %}>Pedir carta</button>
    </form>
    <form action="/stand" method="get" style="display:inline;">
        <button type="submit" class="btn-plantarse" {% if pc_animating %}disabled{% endif %}>Plantarse</button>
    </form>
    <h3>Historial:</h3>
    <ul>
        {% for h in history %}
            {% if h.winner == 'Usuario' or h.winner == 'Jugador' %}
                <li class="hist-usuario">Ronda {{ h.round }}: Jugador {{ h.player }} - PC {{ h.pc }} | Ganador: {{ h.winner }}</li>
            {% elif h.winner == 'PC' or h.winner == 'Pc' or h.winner == 'pc' %}
                <li class="hist-pc">Ronda {{ h.round }}: Jugador {{ h.player }} - PC {{ h.pc }} | Ganador: {{ h.winner }}</li>
            {% else %}
                <li>Ronda {{ h.round }}: Jugador {{ h.player }} - PC {{ h.pc }} | Ganador: {{ h.winner }}</li>
            {% endif %}
        {% endfor %}
    </ul>
</body>
</html>
